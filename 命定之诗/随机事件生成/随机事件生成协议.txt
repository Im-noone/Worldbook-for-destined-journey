{{setvar::random_event_trigger::
æ˜¯ï¼Œå‚è€ƒ<random_event_trigger_protocol>}}

<random_event_trigger_protocol>
# éšæœºäº‹ä»¶è§¦å‘æ€»åè®®
# æœ¬åè®®ç»Ÿä¸€ç®¡ç†æ¸¸æˆä¸­å„ç±»éšæœºäº‹ä»¶çš„è§¦å‘é€»è¾‘
# äº‹ä»¶æŒ‰è§¦å‘æ¦‚ç‡ä»å°åˆ°å¤§æ’åˆ—ï¼Œä¸€æ—¦è§¦å‘åˆ™åç»­äº‹ä»¶ä¸è§¦å‘

event_priority_check:
  description: "æŒ‰æ¦‚ç‡ä»å°åˆ°å¤§é¡ºåºæ£€æŸ¥äº‹ä»¶è§¦å‘ï¼Œä½¿ç”¨å•æ¬¡éšæœºæ•°åˆ¤å®š"
  trigger_mechanism: "ç”Ÿæˆéšæœºæ•°åä¾æ¬¡æ¯”è¾ƒå„äº‹ä»¶æ¦‚ç‡é˜ˆå€¼"
  execution_order: "ä¸€æ—¦æŸä¸ªäº‹ä»¶è§¦å‘ï¼Œç«‹å³ç»ˆæ­¢åç»­æ£€æŸ¥"

  probability_calculation:
    method: "ä½¿ç”¨ç»Ÿä¸€éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œç”Ÿæˆ0-100çš„éšæœºå€¼"
    formula: "random_value = roll:1d100"
    comparison: "éšæœºæ•°å°äºäº‹ä»¶æ¦‚ç‡é˜ˆå€¼åˆ™è§¦å‘"

event_generation_steps:
  å¥‡é‡äº‹ä»¶:
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 2 && getvar('stat_data.è§’è‰².çŠ¶æ€.ç­‰çº§') > 13 ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::true}}
      {{setvar::current_event_type::"å¥‡é‡äº‹ä»¶"}}
      generate_step:
        - step1: "ç‰¹æ®ŠåŒºåŸŸåˆ¤å®š - ç¡®å®šå¥‡é‡å‘ç”Ÿçš„è¶…è‡ªç„¶åŒºåŸŸç±»å‹"
        - step2: "æ¦‚å¿µæŠ½å– - ä»æ—¶ç©ºã€å…ƒç´ ã€æ¦‚å¿µã€ç¥æ€§ç­‰æŠ½è±¡é¢†åŸŸéšæœºé€‰æ‹©"
        - step3: "éš¾åº¦é€‚é… - åŸºäºç©å®¶ç­‰çº§å’Œç”Ÿå‘½å±‚çº§è°ƒæ•´å¥‡é‡æŒ‘æˆ˜"
        - step4: "å™äº‹æ„å»º - ç”Ÿæˆè¶…è¶Šå¸¸è§„ç°å®çš„æè¿°å’Œä½“éªŒ"
        - step5: "å¥–åŠ±ç”Ÿæˆ - æä¾›æ¦‚å¿µæ€§ã€æ³•åˆ™æ€§æˆ–ç¥æ€§ç›¸å…³çš„ç‹¬ç‰¹å¥–åŠ±"
      reference_protocol: "<legend_event_protocol>"
    <% } %>

  éšæœºé­é‡æˆ˜:
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 6 && !getvar('stat_data.è§’è‰².åœ¨å†›é˜Ÿä¸­') && %> å½“å‰ä¸åœ¨å…³é”®å¯¹è¯æˆ–æˆ˜æ–—ä¸­ <% ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::true}}
      {{setvar::current_event_type::"éšæœºé­é‡æˆ˜"}}
      generate_step:
        - step1: "ç©å®¶çŠ¶æ€è¯„ä¼° - åˆ†æç­‰çº§ã€è£…å¤‡ã€æŠ€èƒ½ã€èµ„æºçŠ¶æ€"
        - step2: "ç¯å¢ƒé£é™©è¯„ä¼° - æ ¹æ®ä½ç½®ç¡®å®šé­é‡ç±»å‹å’Œæ•Œäººç§ç±»"
        - step3: "éš¾åº¦è°ƒæ•´ - è°ƒæ•´è‡³'æœ‰æŒ‘æˆ˜æ€§ä½†å¯å®Œæˆ'æ°´å¹³"
        - step4: "æ•Œäººç”Ÿæˆ - ç”Ÿæˆ1-3ä¸ªåŒ¹é…ç­‰çº§çš„å®Œæ•´æ•Œäººæ¡£æ¡ˆ"
        - step5: "æˆ˜æ–—åœºæ™¯ç”Ÿæˆ - åˆ›å»ºç¬¦åˆç¯å¢ƒçš„æˆ˜æ–—åœºåœ°"
        - step6: "æˆ˜æ–—æ‰§è¡Œ - è¿›å…¥<combat_round_protocol>æµç¨‹"
        - step7: "ç»“æœåˆ¤å®š - æ ¹æ®æˆ˜æ–—è¡¨ç°è®¡ç®—å¥–åŠ±"
      reference_protocol: "<individual_encounter_protocol>"
    <% } %>

  æˆ˜å½¹äº‹ä»¶:
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 6 && getvar('stat_data.è§’è‰².åœ¨å†›é˜Ÿä¸­') && getvar('stat_data.è§’è‰².å†›é˜ŸçŠ¶æ€') in ['è¡Œå†›', 'é©»æ‰'] ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::true}}
      {{setvar::current_event_type::"æˆ˜å½¹äº‹ä»¶"}}
          
      generate_step:
        - step1: "æˆ˜åœºç¯å¢ƒè¯„ä¼° - ç¡®å®šåœ°å½¢ç±»å‹å’Œä¼˜åŠ£åŠ¿"
        - step2: "å®åŠ›å¯¹æ¯”åˆ†æ - è®¡ç®—æ•Œæˆ‘åŒæ–¹å®åŠ›æ¯”å€¼"
        - step3: "ç©å®¶çŠ¶æ€åˆ¤å®š - æ ¹æ®å†›è¡”å’Œç­‰çº§ç¡®å®šå†³ç­–æƒé‡"
        - step4: "é˜¶æ®µä¸å£«æ°”åˆ¤å®š - ç¡®å®šå½“å‰æˆ˜æ–—é˜¶æ®µå’Œå£«æ°”æ°´å¹³"
        - step5: "äº‹ä»¶è§¦å‘ - ä»å½“å‰åœ°å½¢äº‹ä»¶è¡¨ä¸­éšæœºé€‰æ‹©"
        - step6: "éš¾åº¦ä¿®æ­£ - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´äº‹ä»¶éš¾åº¦"
        - step7: "äº‹ä»¶å™è¿° - ç”Ÿæˆ50-150å­—æˆ˜åœºæè¿°"
        - step8: "åæœç”Ÿæˆ - æä¾›é˜¶æ®µå˜åŒ–ã€çŠ¶æ€è°ƒæ•´ç­‰åæœ"
      reference_protocol: "<battlefield_event_protocol>"
    <% } %>

  ä»»åŠ¡å‹éšæœºäº‹ä»¶:
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 15 && %> å½“å‰ä¸åœ¨å…³é”®å¯¹è¯æˆ–æˆ˜æ–—ä¸­ <%  ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::true}}
      {{setvar::current_event_type::"ä»»åŠ¡å‹éšæœºäº‹ä»¶"}}
      generate_step:
        - step1: "åŒºåŸŸåˆ¤å®š - ç¡®å®šè§’è‰²æ‰€åœ¨åŒºåŸŸç±»å‹åŠå­åŒºåŸŸ"
        - step2: "åŠ¿åŠ›å…³è” - æ ¹æ®åŒºåŸŸç¡®å®šå¯èƒ½æ¶‰åŠçš„åŠ¿åŠ›ç±»å‹"
        - step3: "ä»»åŠ¡è§¦å‘ - ä»å¯¹åº”åŒºåŸŸä»»åŠ¡è¡¨ä¸­éšæœºé€‰æ‹©"
        - step4: "éš¾åº¦é€‚é… - åŸºäºè§’è‰²ç­‰çº§å’Œä½ç½®è°ƒæ•´ä»»åŠ¡éš¾åº¦"
        - step5: "çº¿ç´¢å‘ˆç° - ç”Ÿæˆ50-200å­—ä»»åŠ¡å¼•å­æè¿°"
        - step6: "ä»»åŠ¡é¢æ¿ç”Ÿæˆ - è°ƒç”¨<ä»»åŠ¡ä¸å§”æ‰˜ç”Ÿæˆè§„åˆ™>"
      reference_protocol: "<task_generation_protocol>"
    <% } %>

  ç‹å›½æˆ˜äº‰äº‹ä»¶:
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 25 && getvar('stat_data.è§’è‰².çŠ¶æ€.ç­‰çº§') >= 8 ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::true}}
      {{setvar::current_event_type::"ç‹å›½æˆ˜äº‰äº‹ä»¶"}}
          <% } %>
      generate_step:
        - step1: "çˆµä½çŠ¶æ€æ£€æŸ¥ - ç¡®è®¤è§’è‰²æ˜¯å¦æ‹¥æœ‰çˆµä½"
        - step2: "ä½ç½®æƒ…å¢ƒåˆ¤å®š - åŒºåˆ†å®‰å…¨ä½ç½®ä¸å±é™©ä½ç½®"
        - step3: "äº‹ä»¶ç±»å‹é€‰æ‹© - åŸºäºçˆµä½å’Œä½ç½®ç”Ÿæˆå¯¹åº”æˆ˜äº‰äº‹ä»¶"
        - step4: "åŠ¿åŠ›å…³ç³»å½±å“ - è€ƒè™‘å‹æ–¹ã€æ•Œæ–¹æˆ–ä¸­ç«‹åŠ¿åŠ›ä»‹å…¥"
        - step5: "å™äº‹é›†æˆ - å°†æˆ˜äº‰ä¿¡æ¯è‡ªç„¶èå…¥å¯¹è¯æˆ–ç¯å¢ƒ"
      reference_protocol: "<kingdom_war_protocol>"

  

  æ²‰æµ¸æ„Ÿå¢å¼ºäº‹ä»¶:
    
    <%if ( {{getvar::trigger_random_event}} == false &&  random_value < 80 && %> å½“å‰ä¸åœ¨å…³é”®å¯¹è¯æˆ–æˆ˜æ–—ä¸­ <% ) { %>
      {{setvar::trigger_random_event::true}}
      {{setvar::event_border_generate::false}}
      {{setvar::current_event_type::"æ²‰æµ¸æ„Ÿå¢å¼ºäº‹ä»¶"}}
      generate_step:
        - step1: "ä½ç½®åˆ¤å®š - ç¡®å®šè§’è‰²æ‰€åœ¨çš„å¤§åŒºåŸŸç±»å‹"
        - step2: "å­åŒºåŸŸåˆ¤å®š - éšæœºé€‰æ‹©æˆ–åŸºäºä¸Šä¸‹æ–‡ç¡®å®šå­åŒºåŸŸ"
        - step3: "äº‹ä»¶è§¦å‘ - ä»å¯¹åº”åŒºåŸŸäº‹ä»¶è¡¨ä¸­éšæœºé€‰æ‹©"
        - step4: "ç‰¹æ®Šä½ç½®æ£€æŸ¥ - è€ƒè™‘å­£èŠ‚æ€§ã€ç§æ—æˆ–åŠ¿åŠ›å› ç´ "
        - step5: "äº‹ä»¶å™è¿° - ç”Ÿæˆ50-150å­—ç”ŸåŠ¨æ„Ÿå®˜æè¿°"
      reference_protocol: "<immersion_enhancement_protocol>"
    <% } %>

execution_flow:
  - step1: "ç¯å¢ƒçŠ¶æ€æ£€æŸ¥ - ç¡®è®¤æ˜¯å¦å…è®¸è§¦å‘ä»»ä½•éšæœºäº‹ä»¶"
  generate_step:
        - step1: "éšæœºæ•°ç”Ÿæˆ - ç»Ÿä¸€ç”Ÿæˆ0-100çš„éšæœºå€¼"
    - step2: "é¡ºåºæ£€æŸ¥ - æŒ‰æ¦‚ç‡ä»å°åˆ°å¤§ä¾æ¬¡æ£€æŸ¥å„äº‹ä»¶è§¦å‘æ¡ä»¶"
    - step3: "äº‹ä»¶ç”Ÿæˆ - ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„äº‹ä»¶è§¦å‘å¹¶ç”Ÿæˆ"
    - step4: "æµç¨‹ç»ˆæ­¢ - äº‹ä»¶è§¦å‘åç«‹å³ç»ˆæ­¢åç»­æ£€æŸ¥"
    - step5: "çŠ¶æ€æ›´æ–° - é€šè¿‡<UpdateVariable>æ›´æ–°æ¸¸æˆçŠ¶æ€"

# éšæœºäº‹ä»¶è§¦å‘å±•ç¤ºæ 
event_display_format:
  template: |
    <%if ( {{getvar::event_border_generate}} == true ) { %>
    <div style="
      border: 2px solid {{border_color}};
      border-radius: 8px;
      background: linear-gradient(135deg, {{background_color}}20, {{background_color}}60);
      padding: 12px;
      margin: 10px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    ">
      <div style="display: flex; align-items: center; margin-bottom: 8px;">
        <span style="font-size: 24px; margin-right: 10px;">{{icon}}</span>
        <span style="font-weight: bold; font-size: 18px; color: {{text_color}};">{{event_type}}</span>
      </div>
      <div style="
        border-top: 1px solid {{border_color}}40;
        padding-top: 8px;
        font-size: 14px;
        color: {{text_color}}90;
      ">
        {{event_description}}
      </div>
    </div>
    {{setvar::event_border_generate::false}}
    <% } %>
  
  display_configs:
    å¥‡é‡äº‹ä»¶:
      background_color: "#6A0DAD"
      border_color: "#8A2BE2"
      text_color: "#E6E6FA"
      icon: "ğŸ”®"
    
    éšæœºé­é‡æˆ˜:
      background_color: "#8B0000" 
      border_color: "#DC143C"
      text_color: "#FFE4E1"
      icon: "âš”ï¸"
    
    ä»»åŠ¡å‹éšæœºäº‹ä»¶:
      background_color: "#1E90FF"
      border_color: "#4169E1"
      text_color: "#F0F8FF"
      icon: "ğŸ“œ"
    
    ç‹å›½æˆ˜äº‰äº‹ä»¶:
      background_color: "#DAA520"
      border_color: "#FFD700"
      text_color: "#FFF8DC"
      icon: "ğŸ°"
    
    æˆ˜å½¹äº‹ä»¶:
      background_color: "#2F4F4F"
      border_color: "#708090"
      text_color: "#F5F5F5"
      icon: "ğŸ›¡ï¸"

output_format:
  event_trigger: "äº‹ä»¶è§¦å‘åº”è‡ªç„¶èå…¥å™äº‹æµç¨‹ï¼Œä¸æ˜¾å¼æ ‡æ³¨æ¦‚ç‡è®¡ç®—"
  narrative_integration: "æ‰€æœ‰äº‹ä»¶æè¿°å¿…é¡»ç¬¦åˆå½“å‰ç¯å¢ƒå’Œå‰§æƒ…èƒŒæ™¯"
  variable_handling: "çŠ¶æ€å˜åŒ–ç»Ÿä¸€åœ¨<UpdateVariable>ä¸­å¤„ç†"
  protocol_reference: "äº‹ä»¶ç”Ÿæˆä¸¥æ ¼éµå¾ªå¯¹åº”åè®®çš„æ ‡å‡†æµç¨‹"
  display_requirement: "æ¯ä¸ªè§¦å‘çš„äº‹ä»¶å¿…é¡»ä½¿ç”¨å¯¹åº”çš„å±•ç¤ºæ æ ¼å¼æ˜¾ç¤º"

</random_event_trigger_protocol>