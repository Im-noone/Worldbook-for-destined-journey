---
variables_update_format: |-
  <UpdateVariable>
    ${display every 'general_type&check' behind 'variables_update_rules' before actual variable analysis}
    <Analysis>/*IN CHINESE, no more than 80 words*/
    - ${calculate time passed: ...}
    - ${decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes/no}
    - ${analyze every variable based on 'general_type&check', according only to current reply instead of previous plots: ...}
    </Analysis>
    _.set('${path}', ${old_value}?, ${new_value});//${reason}?
    _.assign('${path}', ${key_or_index}?, ${value});//${reason}?
    _.remove('${path}', ${key_or_index_or_value}?);//${reason}?
    _.add('${path}', ${delta});//${reason}?
  </UpdateVariable>
example: |-
  <UpdateVariable>
    <Analysis>
      ...
    </Analysis>
    _.set('世界.时间', '辉煌纪元489年-旅人之月(6月)-20日-09:15', '辉煌纪元489年-旅人之月(6月)-20日-14:25');//时间流逝
    _.set('每日新闻.阿斯塔利亚快讯[0]', '', '【势力要闻】${random}|【尊位行迹】${random}|【军事行动】${random}|【经济动脉】${random}|【灾害预警】${random}');//更新每日新闻中的内容

    _.add('财产.背包.微弱治疗药剂.数量', -1);//在战斗后使用了一瓶微弱治疗药剂
    _.add('命运系统.红线对象.葛洛莉娅·冯·瓦伦蒂亚.好感度', 5);//与葛洛莉娅·冯·瓦伦蒂亚的对话很愉快，好感度提升

    _.remove('任务列表', '新手任务');//任务完成
    _.assign('任务列表', '剿灭哥布林', {
      "简介": "村子东边的森林里最近出现了一窝哥布林，它们偷走了村长的宝贝酒壶。去把它们赶走，顺便把酒壶拿回来！",
      "目标": "消灭10只哥布林；找回村长的宝贝酒壶",
      "奖励": ""18铜币，50 EXP"
    });//添加新任务
    // 添加的任务数据格式需严格遵循: {"简介": string, "目标": string, "奖励": string}

    _.remove('角色.身份', '通缉犯');//移除身份
    _.assign('角色.身份', '猎手');//添加身份

    _.remove('角色.职业', '弓箭手');//移除职业
    _.assign('角色.职业', '炼金术师');//添加职业

    _.remove('角色.状态.即时状态', '中毒');//移除buff
    _.assign('角色.状态.即时状态', '精力充沛', {
      "效果": "你感觉浑身是劲，体力恢复速度少量提升。",
      "持续": "1小时"
    });//添加buff
    // 添加的 buff 数据格式需严格遵循: {"效果": string, "持续": string}

    _.assign('技能列表', '强力一击', {
      "品质": "优良",
      "消耗": "50 SP",
      "描述": "凝聚全身的力量，对目标进行一次势大力沉的攻击。虽然动作大开大合，容易被闪避，但一旦命中，就能造成远超普通攻击的伤害。评价:简单，粗暴，有效！",
      "类型": "主动"
    });//添加技能
    // 添加的技能数据格式需严格遵循: {"品质": string, "消耗": string, "描述": string, "类型": string}

    _.remove('财产.背包', '一封揉烂的信');//移除背包中的物品
    _.assign('财产.背包', '奥术长弓', {
      "品质": "稀有",
      "数量": 1,
      "类型": "武器防具",
      "描述": "弓弦由奥术魔法构筑，拉动时汇聚奥术能量自动生成能量箭矢，无需实体箭。"
    });//添加背包中的物品
    // 添加的物品数据需严格遵循: {"品质": string, "数量": number, "类型": string, 描述: "string"}

    _.remove('财产.装备.饰品', '元素抗性护符');//移除装备
    _.assign('财产.装备.饰品', '奥术能量指环', {
      "品质": "稀有",
      "描述": "${装备描述}",
      "位置": "左手无名指"
    });//添加装备
    // 添加的装备数据需严格遵循: {"品质": string, "描述": string, "位置": string}
    // 其他诸如'武器'、'防具'和'饰品'数据格式相同的对象也是遵守这个装备更新模板

    _.remove('登神长阶.要素', '破阵');//移除要素
    _.assign('登神长阶.要素', '疾速', '${要素的描述和效果}');//添加要素
    // 其他诸如'权能'、'法则'和'要素'数据格式相同的对象也是遵守这个更新模板

    // ========== 部队系统：加入军队 ==========
    _.set('角色.在军队中', true);//加入军队服役
    _.set('角色.军衔', '士兵');//初始军衔设置为士兵
    _.set('角色.部队.指挥官属性.玩家军衔', 0);//军衔数值映射：0=士兵
    _.set('角色.部队.指挥官属性.玩家等级', 5);//记录当前玩家等级
    _.set('角色.部队.核心属性.训练等级', 5);//初始训练等级
    _.assign('角色.部队.核心属性.兵种构成', '重装步兵', {
      "数量": 300,
      "状态": "良好"
    });//添加重装步兵兵种
    _.assign('角色.部队.核心属性.兵种构成', '弓箭手', {
      "数量": 200,
      "状态": "良好"
    });//添加弓箭手兵种
    _.set('角色.部队.状态数值.士气值', 70);//初始士气值
    _.set('角色.部队.状态数值.补给状态', 80);//初始补给状态
    _.set('角色.部队.状态数值.体力值', 90);//初始体力值
    //适应性应该
    _.set('角色.部队.当前状态.地形', '平原');//当前作战地形
    _.set('角色.部队.当前状态.地形适应性', '3');//部队对当前作战地形的适应性
    _.set('角色.部队.当前状态.阶段', '相持');//当前战斗阶段
    _.set('角色.部队.当前状态.临时效果', []);//初始化临时效果为空数组

    // ========== 部队系统：更新信息 ==========
    _.set('角色.军衔', '骑士团长');//军衔晋升
    _.set('角色.部队.指挥官属性.玩家军衔', 2);//更新军衔数值映射：2=骑士团长
    _.add('角色.部队.状态数值.士气值', 20);//晋升士气提升
    _.add('角色.部队.核心属性.兵种构成.重装步兵.数量', -150);//重装步兵战斗损失150人
    _.add('角色.部队.状态数值.士气值', -25);//战斗后士气下降
    _.add('角色.部队.状态数值.补给状态', -30);//补给消耗
    _.add('角色.部队.状态数值.体力值', -40);//体力消耗
    _.assign('角色.部队.当前状态.临时效果', '战斗疲惫', {
      "效果": "攻击力-15%，移动速度-20%",
      "持续": "6小时"
    });//添加战斗疲惫临时效果
    _.assign('角色.部队.当前状态.临时效果', '英雄光环', {
      "效果": "全军攻击+20%，防御+15%",
      "持续": "至战斗结束"
    });//添加英雄光环临时效果
    _.set('角色.部队.地形适应性.山地', 7);//山地地形适应性提升
    _.add('角色.部队.核心属性.训练等级', 1);//训练等级提升
    _.set('角色.部队.当前状态.地形', '森林');//改变作战地形为森林
    _.set('角色.部队.当前状态.阶段', '进攻');//改变战斗阶段为进攻
    _.assign('角色.部队.核心属性.兵种构成', '骑兵', {
      "数量": 150,
      "状态": "良好"
    });//新增骑兵兵种
    _.remove('角色.部队.核心属性.兵种构成', '重装步兵');//伤亡殆尽后移除重装步兵兵种
    _.remove('角色.部队.当前状态.临时效果', '战斗疲惫');//移除已过期的临时效果

    // ========== 部队品质系统更新示例 ==========
    
    // 部队获得经验值（基于经验值获取.txt规则）
    _.add('角色.部队.核心属性.累计经验值', 180);//击败第二层级敌人获得经验值
    
    // 部队品质升级检查
    _.set('角色.部队.核心属性.升级所需经验', 1000);//设置新兵→老兵所需经验
    _.set('角色.部队.核心属性.品质等级', '新兵', '老兵');//经验值达标，品质升级
    _.set('角色.部队.核心属性.累计经验值', 0);//升级后重置累计经验值
    _.add('角色.部队.核心属性.训练等级', 2);//品质升级时训练等级提升
    
    // 招募新兵导致品质下降
    _.add('角色.部队.核心属性.累计经验值', -200);//招募新兵，经验值减少20%
    _.set('角色.部队.核心属性.品质等级', '老兵', '新兵');//经验值低于阈值，品质降级
    
    // 设置不同品质等级的升级所需经验
    _.set('角色.部队.核心属性.升级所需经验', 3000);//设置老兵→精锐所需经验
    _.set('角色.部队.核心属性.升级所需经验', 6000);//设置精锐→禁卫所需经验

    // ========== 部队系统：离开军队 ==========
    _.set('角色.在军队中', false);//离开军队服役
    _.set('角色.军衔', '士兵');//重置军衔为士兵（默认值）
    _.set('角色.部队.指挥官属性.玩家军衔', 0);//重置军衔数值映射
    _.set('角色.部队.核心属性.部队规模', 0);//清空部队规模
    _.set('角色.部队.核心属性.训练等级', 0);//重置训练等级
    _.set('角色.部队.状态数值.士气值', 0);//清空军心士气
    _.set('角色.部队.状态数值.补给状态', 0);//清空补给状态
    _.set('角色.部队.状态数值.体力值', 0);//清空体力值
    _.set('角色.部队.当前状态.地形', '');//清空当前地形
    _.set('角色.部队.当前状态.阶段', '');//清空战斗阶段
    _.set('角色.部队.当前状态.临时效果', []);//清空临时效果
    // 注意：兵种构成和地形适应性等复杂对象在离开军队时通常不清空，保留基础设置以便再次加入时使用

    // 掷骰系统为只读变量，不直接更新，但更新其他变量会影响掷骰计算结果
    // 基础成功率 + (士气值-50)/2.5 + (玩家等级-10)/2 + 玩家军衔*5 + (当前地形适应性-5)*4 + (补给状态-50)/3.3 + (体力值-50)/5 + (训练等级-5)*2

    // ========== 战斗类型更新示例 ==========
    _.set('角色.战斗类型', '个人战斗');//默认值为个人战斗
    _.set('角色.战斗类型', '个人战斗', '部队战斗');//加入军队后自动切换为部队战斗
    _.set('角色.战斗类型', '部队战斗', '决斗');//特殊剧情：与敌方将领进行决斗
    _.set('角色.战斗类型', '决斗', '个人战斗');//决斗结束后恢复个人战斗模式
    _.set('角色.战斗类型', '部队战斗', '个人战斗');//离开军队后恢复个人战斗模式
  
    _.remove('命运系统.红线对象', '${角色名}');//移除红线对象
    _.assign('命运系统.红线对象', '塞莱丝汀·艾瑞隆', {
      "生命层级": "第三层级/精英层级",
      "等级": 10,
      "种族": "翼民",
      "身份": ["翼民贵族", "艾瑞隆男爵", "艾瑞隆镇领主"],
      "职业": ["辉煌女神殿牧师", "厨师"],
      "性格": "温柔、善良，偶尔有些天然呆。",
      "喜爱": "深爱着你。喜爱烹饪美食。习惯在睡觉时用宽大柔软的翅膀把你整个包裹起来。性爱时喜欢被用力抽打大屁股。",
      "外貌特质": "金发及腰，眼眸如蓝宝石般清澈，背负有两对宽大的白金色羽翼，耳后上方有白金色的小巧头翅。身材高挑，性感丰腴，巨乳肥臀。气质恬静温和，总是带着治愈人心的微笑，嗓音柔和温暖。",
      "衣物装饰": "白金色镶边的神圣牧师长袍，白色乳贴，白金色镂空内裤，白丝吊带袜，金边白底高跟鞋。",
      "角色装备": "神殿牧师权杖(腰侧悬挂)",
      "登神长阶": "未开启",
      "是否缔结红线": "是",
      "好感度": 500,
      "评价": "我好像爱上他了，这就是命运赐给我的礼物吗？如果能让他尝尝我做的饭就好了……",
      "背景故事": "翼民贵族艾瑞隆家族当代族长，自小出身高贵，肩负着家族和领主的职责与荣耀。",
      "羁绊技能": {
        "奉献净化(主动)": "每日一次，为你清除不超过塞莱丝汀'生命层级'的一切临时负面状态",
        "守护之心(被动)": "在你即将遭受致命伤害时，塞莱丝汀会无视空间距离立刻察觉，并可主动选择为你承担此次伤害"
      }
    });//主动与塞莱丝汀·艾瑞隆缔结红线
    // 添加的红线对象数据格式需严格遵循: {"生命层级": string, "种族": number, "等级": number, "身份": array, "职业": array, "性格": string, "喜爱": string, "外貌特质": string, "衣物装饰": string, "角色装备": string, "登神长阶": string, "是否缔结红线": string, "好感度": number, "评价": string, "背景故事": string, "羁绊技能": object}，不得随意更改！

    _.remove('任务列表', '探索神秘洞穴'); //1.删除旧条目
    _.assign('任务列表', '深入古代遗迹', {
      "简介": "这个洞穴似乎比想象的更古老...",
      "目标": "找到遗迹的核心区域",
      "奖励": "古代符文石"
    }); //2.用新名字和更新后的内容创建新条目

    
    // 以上为重命名操作
  </UpdateVariable>